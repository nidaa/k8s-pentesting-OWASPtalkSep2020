#!/bin/zsh
# Helper script that lets you get your environment setup as a stolen pod
# For example, if you're running through the demo, it's cheating to be the cluster-admin per gcloud credentials. this will take in the IP and the service token of a service you exploit and generate a kubeconfig file for you. Then switch contexts. You can do this all your self but this is just faster

echo "Enter token: "
read TOKEN
echo "Enter kubernetes API host:"
read K8S

echo "Creating configuration for https://$K8S"

DECODE=$(pyjwt decode --no-verify $(<<EOF echo "$TOKEN"
EOF
))

echo "With token:"
echo $DECODE

echo "Press any key to continue..."
read continue


export KUBECONFIG=$HOME/.kube/config
export HISTFILE=./.zsh_history
kubectl config set-credentials nidaa --token="$TOKEN"
kubectl config set-cluster remotekube --insecure-skip-tls-verify=true --server=https://$K8S
kubectl config set-context remotekube --cluster=pwndserver --user=nidaa
kubectl config use-context remotekube
